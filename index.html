<!<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#000000" />
  <meta name="description" content="Interne Helfer App für Team-Koordination" />
  
  <!-- PWA Meta Tags -->
  <link rel="manifest" href="./manifest.json">
  <link rel="icon" type="image/png" href="./icon-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="./icon-512x512.png" sizes="512x512">
  
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <title>Helfer App</title>
</head>
<body>
  <div id="root"></div>
  
  <!-- React & Babel CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.development.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.development.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.22.10/babel.min.js"></script>
  
  <!-- Deine React App -->
  <script type="text/babel">
    const { useEffect, useMemo, useState } = React;

    // 🛠️ Katastrophenschutz-Helfer App (Prototyp)
    const CONFIG = {
      brand: {
        name: "Helfer App",
        logoLetter: "H",
      },
      links: {
        groupAlarmApp: "https://app.groupalarm.com/",
        icalFeed: "https://app.groupalarm.com/api/v1/appointments/ical/public/EV3pB5GRjA",
        whatsappPrimary: "https://chat.whatsapp.com/HDDD0cctUY9KEW5BCSZ7jk",
        whatsappDirect: "https://wa.me/4917012345678?text=Hallo%20Team",
        teams: "https://teams.microsoft.com/l/team/19%3A840ab1376e824466af9b2d69af56b27b%40thread.tacv2/conversations?groupId=dfd21644-ba31-4cac-9c3a-f90bc076762e&tenantId=7a0df6a5-35c9-4bdc-ae48-9c981a4d5559",
        arno: "https://arno.cloud/index.html#!/dashboard",
        planner: "https://planner.cloud.microsoft/webui/plan/KJ6VqdrFp0GVQMeW5LUfPJYABn_H/view/board?tid=7a0df6a5-35c9-4bdc-ae48-9c981a4d5559",
        albumUrl: "https://cloud.example.org/apps/photos/s/TEAM-ALBUM",
        proxyUrl: "",
      },
      forms: [
        { title: "Einsatz-Rückmeldung", url: "https://forms.example.org/rueckmeldung", note: "An/Abmeldung, Verfügbarkeit" },
        { title: "Schadensmeldung Material", url: "https://forms.example.org/schaden", note: "Geräte & Verbrauchsmaterial" },
        { title: "Fortbildungswunsch", url: "https://forms.example.org/fortbildung", note: "Kurse & Termine" },
      ],
      documents: [
        { title: "Alarm- & Ausrückeordnung", url: "https://cloud.example.org/s/AAO.pdf", tags: ["AAO", "Alarm"] },
        { title: "Hygieneplan Verpflegung", url: "https://cloud.example.org/s/Hygieneplan.pdf", tags: ["Hygiene", "Verpflegung"] },
        { title: "Dienstvereinbarung KatS", url: "https://cloud.example.org/s/DV-KatS.pdf", tags: ["Recht", "DV"] },
      ],
      launcher: {
        einsatzdienste: [
          { title: "Einsatzberichte", url: "https://forms.office.com/pages/responsepage.aspx?id=pfYNesk13EuuSJyYGk1VWYBVa_0Efu9ApG8k3ZDAOAVUMzRMMTkzMkNUM1o5Vk1YRjBWQjMxRlVKSS4u&route=shorturl" },
          { title: "Patientenprotokoll", url: "https://forms.office.com/e/fV9cptssSn" },
          { title: "First Responder Protokoll", url: "https://forms.office.com/pages/responsepage.aspx?id=pfYNesk13EuuSJyYGk1VWYBVa_0Efu9ApG8k3ZDAOAVUOUdQVFFGOUJVRFFOUFlBSFk3MjVMT09NUy4u&route=shorturl" },
          { title: "Einsatzbericht Verpflegungsdienst", url: "https://forms.office.com/Pages/ResponsePage.aspx?id=pfYNesk13EuuSJyYGk1VWYBVa_0Efu9ApG8k3ZDAOAVUN1lJTERPWTU0MlI1UjE2OFVVR0IxUTFBRy4u&origin=QRCode&sid=c7501ed7-bda9-4751-96e2-302686dacb44" },
          { title: "Einsatzbericht Drohneneinsatz", url: "https://forms.office.com/pages/responsepage.aspx?id=pfYNesk13EuuSJyYGk1VWYBVa_0Efu9ApG8k3ZDAOAVUQUZQM01KS0JCMkRHWEpQSFVMVkJaVDhMMi4u&route=shorturl" },
        ],
        verwaltung: [
          { title: "SharePoint – Verwaltung", url: "https://maltesercloud-my.sharepoint.com/:f:/g/personal/nico_mueck_malteser_org/Er2fSfaHIHJGtfnsfKYny2UBZV9acC1zwRoNAV2imllcXw?e=tIBynH" },
          { title: "Nextcloud – Team", url: "https://cloud.example.org/apps/files/" },
          { title: "Dienstanweisung Verwaltung (PDF)", url: "https://cloud.example.org/s/Dienstanweisung-Verwaltung.pdf", type: "pdf" },
          { title: "Urlaubs-/Abwesenheitsrichtlinie (PDF)", url: "https://cloud.example.org/s/Urlaubsrichtlinie.pdf", type: "pdf" },
          { title: "Fahrtenbuch Richtlinie (PDF)", url: "https://cloud.example.org/s/Fahrtenbuch-Richtlinie.pdf", type: "pdf" },
        ],
        ticketsystem: [
          { title: "Ticketsystem", url: "https://forms.office.com/e/yNThKqWcv1" },
        ],
        hygiene: [
          { title: "Hygieneplan Verpflegung (PDF)", url: "https://cloud.example.org/s/Hygieneplan.pdf" },
          { title: "Desinfektionsplan", url: "https://cloud.example.org/s/Desinfektionsplan.pdf" },
        ],
        checklisten: [
          { title: "Checkliste Feldküche (PDF)", url: "https://cloud.example.org/s/Checkliste-Feldkueche.pdf" },
          { title: "Checkliste Einsatzrucksack", url: "https://cloud.example.org/s/Checkliste-Rucksack.pdf" },
        ],
        wichtige: [
          { title: "AAO – Alarm- & Ausrückeordnung", url: "https://cloud.example.org/s/AAO.pdf" },
          { title: "Dienstvereinbarung KatS", url: "https://cloud.example.org/s/DV-KatS.pdf" },
        ],
      }
    };

    const BASE_EVENTS = [
      { id: "e1", title: "Übungsdienst Verpflegung", start: "2025-10-05T18:00", end: "2025-10-05T21:00", location: "Unterkunft Lagerhalle", type: "Übung" },
      { id: "e2", title: "Sanitätsdienst Stadtfest", start: "2025-10-12T10:00", end: "2025-10-12T18:00", location: "Innenstadt", type: "Dienst" },
    ];

    const saveLS = (k, v) => localStorage.setItem(k, JSON.stringify(v));
    const loadLS = (k, fallback) => {
      try { return JSON.parse(localStorage.getItem(k)) ?? fallback; } catch { return fallback; }
    };

    function formatDateRange(startISO, endISO) {
      const s = new Date(startISO);
      const e = endISO ? new Date(endISO) : null;
      const fmt = (d) => d.toLocaleString(undefined, { dateStyle: "medium", timeStyle: "short" });
      return e ? `${fmt(s)} – ${fmt(e)}` : fmt(s);
    }

    function useFakeAuth() {
      const [user, setUser] = useState(loadLS("auth_user", { name: "Helfer/in" }));
      useEffect(() => saveLS("auth_user", user), [user]);
      return { user, login: (name) => setUser({ name }), logout: () => setUser(null) };
    }

    function EventTicker() {
      const [events] = useState(() => loadLS("events", BASE_EVENTS));
      const items = useMemo(() => {
        const now = new Date();
        const horizonDays = 10;
        const horizon = new Date(now.getTime() + horizonDays * 86400000);
        return events
          .filter(e => e.start && new Date(e.end || e.start) >= now && new Date(e.start) <= horizon)
          .sort((a,b) => new Date(a.start) - new Date(b.start))
          .map(e => {
            const d = new Date(e.start);
            const dateStr = d.toLocaleDateString(undefined, { weekday:"short", day:"2-digit", month:"2-digit" });
            const timeStr = d.toLocaleTimeString(undefined, { hour:"2-digit", minute:"2-digit" });
            const loc = e.location ? ` @ ${e.location}` : "";
            return `${dateStr} ${timeStr} – ${e.title}${loc}`;
          });
      }, [events]);

      if (!items.length) return null;
      
      return React.createElement('div', { 
        className: "border-b border-gray-200 bg-white/80 backdrop-blur mt-4" 
      },
        React.createElement('style', null, `
          @keyframes ticker { 
            0% { transform: translateX(0); } 
            100% { transform: translateX(-50%); } 
          }
        `),
        React.createElement('div', { className: "overflow-hidden" },
          React.createElement('div', { className: "whitespace-nowrap py-2" },
            React.createElement('div', { 
              className: "inline-block",
              style: { animation: "ticker 30s linear infinite" } 
            },
              [...items, ...items].map((t,i) =>
                React.createElement('span', { 
                  key: i, 
                  className: "mx-6 text-sm text-gray-700" 
                }, `🗓️ ${t}`)
              )
            )
          )
        )
      );
    }

    function BottomDock() {
      const items = [
        { label: "GroupAlarm", icon: "🚨", url: CONFIG.links.groupAlarmApp },
        { label: "WhatsApp", icon: "💬", url: (CONFIG.links.whatsappPrimary || CONFIG.links.whatsappDirect || "#") },
        { label: "Teams", icon: "👥", url: CONFIG.links.teams },
        { label: "ARNO", icon: "🧭", url: CONFIG.links.arno },
        { label: "Planner", icon: "🗂️", url: CONFIG.links.planner },
      ];
      
      return React.createElement('nav', { 
        className: "fixed bottom-2 left-1/2 -translate-x-1/2 z-20 bg-white/90 backdrop-blur rounded-2xl shadow-lg border border-gray-200 px-3 py-2 flex gap-3" 
      },
        items.map((it,idx) =>
          React.createElement('a', {
            key: idx,
            href: it.url,
            target: "_blank",
            rel: "noopener noreferrer",
            className: "w-16 flex flex-col items-center gap-1 text-xs hover:scale-105 transition-transform"
          },
            React.createElement('div', { className: "text-lg" }, it.icon),
            React.createElement('div', null, it.label)
          )
        )
      );
    }

    function TermineTab() {
      const [events, setEvents] = useState(loadLS("events", BASE_EVENTS));
      const [filter, setFilter] = useState("");
      const upcoming = useMemo(() => {
        const now = new Date();
        return events
          .filter((e) => new Date(e.end || e.start) >= now)
          .filter((e) => (filter ? e.type === filter : true))
          .sort((a, b) => new Date(a.start) - new Date(b.start));
      }, [events, filter]);

      useEffect(() => saveLS("events", events), [events]);

      const [draft, setDraft] = useState({ title: "", start: "", end: "", location: "", type: "Übung" });

      function addEvent() {
        if (!draft.title || !draft.start) return;
        setEvents((prev) => [
          ...prev,
          { id: crypto.randomUUID(), ...draft },
        ]);
        setDraft({ title: "", start: "", end: "", location: "", type: draft.type });
      }

      return React.createElement('section', { className: "max-w-6xl mx-auto px-4 py-10" },
        React.createElement('header', { className: "flex flex-col md:flex-row md:items-end md:justify-between gap-4" },
          React.createElement('div', null,
            React.createElement('h2', { className: "text-3xl font-extrabold" }, "Termine"),
            React.createElement('p', { className: "text-gray-600" }, 
              "Zeigt bevorstehende Dienste, Übungen und Treffen. Optionaler iCal-Feed: ",
              React.createElement('a', { 
                className: "underline", 
                href: CONFIG.links.icalFeed.replace(/^https?:/, "webcal:") 
              }, "Kalender abonnieren"),
              "."
            )
          ),
          React.createElement('div', { className: "flex gap-2" },
            React.createElement('select', { 
              value: filter, 
              onChange: (e) => setFilter(e.target.value),
              className: "rounded-xl border border-gray-300 px-3 py-2"
            },
              React.createElement('option', { value: "" }, "Alle Typen"),
              React.createElement('option', null, "Übung"),
              React.createElement('option', null, "Dienst"),
              React.createElement('option', null, "Fortbildung"),
              React.createElement('option', null, "Einsatz")
            )
          )
        ),
        React.createElement(EventTicker),
        React.createElement('div', { className: "grid md:grid-cols-2 gap-4 mt-6" },
          upcoming.map((e) =>
            React.createElement('article', { 
              key: e.id, 
              className: "rounded-2xl border border-gray-200 p-5 bg-white shadow-sm hover:shadow-md transition-shadow" 
            },
              React.createElement('div', { className: "text-sm uppercase tracking-widest text-gray-500" }, e.type || "Termin"),
              React.createElement('h3', { className: "text-lg font-semibold mt-1" }, e.title),
              React.createElement('p', { className: "text-gray-700 mt-1" }, formatDateRange(e.start, e.end)),
              e.location && React.createElement('p', { className: "text-gray-600 mt-1" }, "📍 ", e.location)
            )
          )
        ),
        React.createElement('div', { className: "mt-8 rounded-2xl border border-gray-200 p-5 bg-white shadow-sm" },
          React.createElement('div', { className: "text-sm uppercase tracking-widest text-gray-500" }, "Neuer Termin (lokal gespeichert)"),
          React.createElement('div', { className: "grid md:grid-cols-5 gap-3 mt-3" },
            React.createElement('input', {
              placeholder: "Titel",
              className: "rounded-xl border border-gray-300 px-3 py-2",
              value: draft.title,
              onChange: (e) => setDraft({...draft, title: e.target.value})
            }),
            React.createElement('input', {
              type: "datetime-local",
              className: "rounded-xl border border-gray-300 px-3 py-2",
              value: draft.start,
              onChange: (e) => setDraft({...draft, start: e.target.value})
            }),
            React.createElement('input', {
              type: "datetime-local",
              className: "rounded-xl border border-gray-300 px-3 py-2",
              value: draft.end,
              onChange: (e) => setDraft({...draft, end: e.target.value})
            }),
            React.createElement('input', {
              placeholder: "Ort",
              className: "rounded-xl border border-gray-300 px-3 py-2",
              value: draft.location,
              onChange: (e) => setDraft({...draft, location: e.target.value})
            }),
            React.createElement('select', {
              className: "rounded-xl border border-gray-300 px-3 py-2",
              value: draft.type,
              onChange: (e) => setDraft({...draft, type: e.target.value})
            },
              React.createElement('option', null, "Übung"),
              React.createElement('option', null, "Dienst"),
              React.createElement('option', null, "Fortbildung"),
              React.createElement('option', null, "Einsatz")
            )
          ),
          React.createElement('button', {
            onClick: addEvent,
            className: "mt-3 px-4 py-2 rounded-xl bg-black text-white text-sm shadow hover:bg-gray-800 transition-colors"
          }, "Termin hinzufügen")
        )
      );
    }

    function HomeTab() {
      const [open, setOpen] = useState(null);
      const [previewUrl, setPreviewUrl] = useState(null);
      const groups = [
        { key: "einsatzdienste", label: "Einsatzdienste", icon: "🚑" },
        { key: "verwaltung", label: "Verwaltung", icon: "🏢" },
        { key: "ticketsystem", label: "Ticketsystem", icon: "🎫" },
        { key: "hygiene", label: "Hygiene", icon: "🧼" },
        { key: "checklisten", label: "Checklisten", icon: "✅" },
        { key: "wichtige", label: "Wichtige Unterlagen", icon: "📚" },
      ];
      const data = CONFIG.launcher;

      return React.createElement('section', { className: "max-w-6xl mx-auto px-4 py-14" },
        React.createElement('div', { className: "grid grid-cols-2 md:grid-cols-3 gap-5 place-items-stretch" },
          groups.map((g) =>
            React.createElement('button', {
              key: g.key,
              onClick: () => setOpen(g.key),
              className: "rounded-2xl border border-gray-200 bg-white shadow-sm p-6 text-left hover:bg-gray-50 flex flex-col items-start gap-2 transition-all hover:scale-105"
            },
              React.createElement('div', { className: "text-2xl" }, g.icon),
              React.createElement('div', { className: "text-lg font-semibold" }, g.label),
              React.createElement('div', { className: "text-sm text-gray-600" }, "Tippe zum Öffnen")
            )
          )
        ),
        open && React.createElement('div', { className: "fixed inset-0 z-30" },
          React.createElement('div', { 
            className: "absolute inset-0 bg-black/40", 
            onClick: () => setOpen(null) 
          }),
          React.createElement('div', { 
            className: "absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[92vw] max-w-2xl rounded-2xl border border-gray-200 bg-white shadow-xl p-5" 
          },
            React.createElement('div', { className: "flex items-center justify-between" },
              React.createElement('div', { className: "text-lg font-semibold" }, 
                groups.find(x => x.key === open)?.label
              ),
              React.createElement('button', {
                onClick: () => setOpen(null),
                className: "px-3 py-1 border border-gray-300 rounded-xl text-sm bg-white hover:bg-gray-50"
              }, "Schließen")
            ),
            React.createElement('div', { className: "mt-4 grid sm:grid-cols-2 gap-3" },
              (data[open] || []).map((it, i) => {
                const isPdf = (it.type === 'pdf') || /\.pdf(\?|$)/i.test(it.url || '');
                return React.createElement('div', {
                  key: i,
                  className: "rounded-xl border border-gray-200 bg-white p-4 hover:shadow-md transition-shadow"
                },
                  React.createElement('div', { className: "font-medium" }, it.title),
                  it.note && React.createElement('div', { className: "text-sm text-gray-600 mt-1" }, it.note),
                  React.createElement('div', { className: "mt-3 flex gap-2" },
                    isPdf && React.createElement('button', {
                      onClick: () => setPreviewUrl(it.url),
                      className: "px-3 py-2 rounded-xl border border-gray-300 bg-white text-sm hover:bg-gray-50"
                    }, "Vorschau"),
                    React.createElement('a', {
                      href: it.url,
                      target: "_blank",
                      rel: "noopener noreferrer",
                      className: "px-3 py-2 rounded-xl bg-black text-white text-sm hover:opacity-90"
                    }, "Öffnen")
                  )
                );
              })
            )
          )
        ),
        previewUrl && React.createElement('div', { className: "fixed inset-0 z-40" },
          React.createElement('div', { 
            className: "absolute inset-0 bg-black/50", 
            onClick: () => setPreviewUrl(null) 
          }),
          React.createElement('div', { 
            className: "absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[96vw] h-[85vh] max-w-5xl rounded-2xl border border-gray-200 bg-white shadow-2xl p-4" 
          },
            React.createElement('div', { className: "flex items-center justify-between" },
              React.createElement('div', { className: "font-semibold" }, "PDF-Vorschau"),
              React.createElement('div', { className: "flex gap-2" },
                React.createElement('a', {
                  href: previewUrl,
                  target: "_blank",
                  rel: "noopener noreferrer",
                  className: "px-3 py-1 rounded-xl border border-gray-300 text-sm bg-white hover:bg-gray-50"
                }, "In neuem Tab"),
                React.createElement('button', {
                  onClick: () => setPreviewUrl(null),
                  className: "px-3 py-1 rounded-xl border border-gray-300 text-sm bg-white hover:bg-gray-50"
                }, "Schließen")
              )
            ),
            React.createElement('div', { className: "mt-2 h-[calc(85vh-60px)] border rounded-lg overflow-hidden" },
              React.createElement('iframe', { 
                src: previewUrl, 
                className: "w-full h-full",
                title: "PDF Vorschau"
              })
            )
          )
        )
      );
    }

    function HelferApp() {
      const [tab, setTab] = useState("home");
      const { user, login, logout } = useFakeAuth();

      const TabButton = ({ id, label }) =>
        React.createElement('button', {
          onClick: () => setTab(id),
          className: `px-4 py-2 rounded-xl text-sm font-medium transition shadow-sm border
            ${tab === id ? "bg-black text-white border-black" : "bg-white hover:bg-gray-50 border-gray-200"}`,
          'aria-pressed': tab === id
        }, label);

      return React.createElement('div', { className: "min-h-screen pb-24 bg-gradient-to-b from-gray-50 to-white text-gray-900" },
        React.createElement('header', { className: "sticky top-0 z-10 backdrop-blur bg-white/70 border-b border-gray-200" },
          React.createElement('div', { className: "max-w-6xl mx-auto px-4 py-4 flex items-center justify-between" },
            React.createElement('div', { className: "flex items-center gap-2" },
              React.createElement('div', { className: "h-9 w-9 rounded-2xl bg-black text-white grid place-items-center font-bold" }, 
                CONFIG.brand.logoLetter
              ),
              React.createElement('div', { className: "text-lg font-semibold tracking-tight" }, CONFIG.brand.name)
            ),
            React.createElement('nav', { className: "flex gap-2" },
              React.createElement(TabButton, { id: "home", label: "Start" }),
              React.createElement(TabButton, { id: "termine", label: "Termine" }),
              React.createElement(TabButton, { id: "chat", label: "Chat" }),
              React.createElement(TabButton, { id: "album", label: "Bilderalbum" }),
              React.createElement(TabButton, { id: "forms", label: "Formulare" }),
              React.createElement(TabButton, { id: "files", label: "Dateien" })
            ),
            React.createElement('div', { className: "hidden md:flex items-center gap-2" },
              user ? [
                React.createElement('span', { 
                  className: "text-sm text-gray-600", 
                  key: "greet" 
                }, "Hallo, ", user.name),
                React.createElement('button', { 
                  onClick: logout, 
                  className: "px-3 py-2 rounded-xl border border-gray-300 bg-white text-sm hover:bg-gray-50",
                  key: "logout"
                }, "Abmelden")
              ] : 
              React.createElement('button', {
                onClick: () => login("Helfer/in"),
                className: "px-3 py-2 rounded-xl bg-black text-white text-sm hover:bg-gray-800"
              }, "Anmelden")
            )
          )
        ),
        tab === "home" && React.createElement(HomeTab),
        tab === "termine" && React.createElement(TermineTab),
        React.createElement(BottomDock),
        React.createElement('footer', { className: "border-t border-gray-200 py-8 mt-10" },
          React.createElement('div', { className: "max-w-6xl mx-auto px-4 text-sm text-gray-500" },
            "© ", new Date().getFullYear(), " ", CONFIG.brand.name, ". Bereit für Einsatz & Übung."
          )
        )
      );
    }

    // App rendern
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(HelferApp));
  </script>

  <!-- Service Worker Registrierung -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('./sw.js')
          .then(function(registration) {
            console.log('ServiceWorker registration successful');
          })
          .catch(function(err) {
            console.log('ServiceWorker registration failed: ', err);
          });
      });
    }
  </script>
</body>
</html>
